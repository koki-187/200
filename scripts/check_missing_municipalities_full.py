#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
1éƒ½3çœŒã®å…¨è‡ªæ²»ä½“ãƒªã‚¹ãƒˆã¨ç¾åœ¨ã®VERIFIEDè‡ªæ²»ä½“ã‚’æ¯”è¼ƒã—ã€ä¸è¶³è‡ªæ²»ä½“ã‚’ç‰¹å®š
"""

# 1éƒ½3çœŒã®å…¨è‡ªæ²»ä½“ãƒªã‚¹ãƒˆï¼ˆ2024å¹´12æœˆæ™‚ç‚¹ï¼‰
ALL_MUNICIPALITIES = {
    "æ±äº¬éƒ½": [
        # 23åŒº
        "åƒä»£ç”°åŒº", "ä¸­å¤®åŒº", "æ¸¯åŒº", "æ–°å®¿åŒº", "æ–‡äº¬åŒº", "å°æ±åŒº", "å¢¨ç”°åŒº", "æ±Ÿæ±åŒº",
        "å“å·åŒº", "ç›®é»’åŒº", "å¤§ç”°åŒº", "ä¸–ç”°è°·åŒº", "æ¸‹è°·åŒº", "ä¸­é‡åŒº", "æ‰ä¸¦åŒº", "è±Šå³¶åŒº",
        "åŒ—åŒº", "è’å·åŒº", "æ¿æ©‹åŒº", "ç·´é¦¬åŒº", "è¶³ç«‹åŒº", "è‘›é£¾åŒº", "æ±Ÿæˆ¸å·åŒº",
        # å¸‚éƒ¨ï¼ˆä¸»è¦å¸‚ã®ã¿ - 26å¸‚ï¼‰
        "å…«ç‹å­å¸‚", "ç«‹å·å¸‚", "æ­¦è”µé‡å¸‚", "ä¸‰é·¹å¸‚", "é’æ¢…å¸‚", "åºœä¸­å¸‚", "æ˜­å³¶å¸‚", "èª¿å¸ƒå¸‚",
        "ç”ºç”°å¸‚", "å°é‡‘äº•å¸‚", "å°å¹³å¸‚", "æ—¥é‡å¸‚", "æ±æ‘å±±å¸‚", "å›½åˆ†å¯ºå¸‚", "å›½ç«‹å¸‚", "ç¦ç”Ÿå¸‚",
        "ç‹›æ±Ÿå¸‚", "æ±å¤§å’Œå¸‚", "æ¸…ç€¬å¸‚", "æ±ä¹…ç•™ç±³å¸‚", "æ­¦è”µæ‘å±±å¸‚", "å¤šæ‘©å¸‚", "ç¨²åŸå¸‚",
        "ç¾½æ‘å¸‚", "ã‚ãã‚‹é‡å¸‚", "è¥¿æ±äº¬å¸‚"
    ],
    "ç¥å¥ˆå·çœŒ": [
        # æ”¿ä»¤æŒ‡å®šéƒ½å¸‚
        "æ¨ªæµœå¸‚", "å·å´å¸‚", "ç›¸æ¨¡åŸå¸‚",
        # å¸‚éƒ¨
        "æ¨ªé ˆè³€å¸‚", "å¹³å¡šå¸‚", "éŒå€‰å¸‚", "è—¤æ²¢å¸‚", "å°ç”°åŸå¸‚", "èŒ…ãƒ¶å´å¸‚", "é€—å­å¸‚",
        "ä¸‰æµ¦å¸‚", "ç§¦é‡å¸‚", "åšæœ¨å¸‚", "å¤§å’Œå¸‚", "ä¼Šå‹¢åŸå¸‚", "æµ·è€åå¸‚", "åº§é–“å¸‚",
        "å—è¶³æŸ„å¸‚", "ç¶¾ç€¬å¸‚"
    ],
    "åƒè‘‰çœŒ": [
        # æ”¿ä»¤æŒ‡å®šéƒ½å¸‚
        "åƒè‘‰å¸‚",
        # å¸‚éƒ¨
        "éŠšå­å¸‚", "å¸‚å·å¸‚", "èˆ¹æ©‹å¸‚", "é¤¨å±±å¸‚", "æœ¨æ›´æ´¥å¸‚", "æ¾æˆ¸å¸‚", "é‡ç”°å¸‚", "èŒ‚åŸå¸‚",
        "æˆç”°å¸‚", "ä½å€‰å¸‚", "æ±é‡‘å¸‚", "æ—­å¸‚", "ç¿’å¿—é‡å¸‚", "æŸå¸‚", "å‹æµ¦å¸‚", "å¸‚åŸå¸‚",
        "æµå±±å¸‚", "å…«åƒä»£å¸‚", "æˆ‘å­«å­å¸‚", "é´¨å·å¸‚", "éŒã‚±è°·å¸‚", "å›æ´¥å¸‚", "å¯Œæ´¥å¸‚",
        "æµ¦å®‰å¸‚", "å››è¡—é“å¸‚", "è¢–ã‚±æµ¦å¸‚", "å…«è¡—å¸‚", "å°è¥¿å¸‚", "ç™½äº•å¸‚", "å¯Œé‡Œå¸‚",
        "å—æˆ¿ç·å¸‚", "åŒç‘³å¸‚", "é¦™å–å¸‚", "å±±æ­¦å¸‚", "ã„ã™ã¿å¸‚", "å¤§ç¶²ç™½é‡Œå¸‚"
    ],
    "åŸ¼ç‰çœŒ": [
        # æ”¿ä»¤æŒ‡å®šéƒ½å¸‚
        "ã•ã„ãŸã¾å¸‚",
        # å¸‚éƒ¨
        "å·è¶Šå¸‚", "ç†Šè°·å¸‚", "å·å£å¸‚", "è¡Œç”°å¸‚", "ç§©çˆ¶å¸‚", "æ‰€æ²¢å¸‚", "é£¯èƒ½å¸‚", "åŠ é ˆå¸‚",
        "æœ¬åº„å¸‚", "æ±æ¾å±±å¸‚", "æ˜¥æ—¥éƒ¨å¸‚", "ç‹­å±±å¸‚", "ç¾½ç”Ÿå¸‚", "é´»å·£å¸‚", "æ·±è°·å¸‚", "ä¸Šå°¾å¸‚",
        "è‰åŠ å¸‚", "è¶Šè°·å¸‚", "è•¨å¸‚", "æˆ¸ç”°å¸‚", "å…¥é–“å¸‚", "æœéœå¸‚", "å¿—æœ¨å¸‚", "å’Œå…‰å¸‚",
        "æ–°åº§å¸‚", "æ¡¶å·å¸‚", "ä¹…å–œå¸‚", "åŒ—æœ¬å¸‚", "å…«æ½®å¸‚", "å¯Œå£«è¦‹å¸‚", "ä¸‰éƒ·å¸‚", "è“®ç”°å¸‚",
        "å‚æˆ¸å¸‚", "å¹¸æ‰‹å¸‚", "é¶´ãƒ¶å³¶å¸‚", "æ—¥é«˜å¸‚", "å‰å·å¸‚", "ãµã˜ã¿é‡å¸‚", "ç™½å²¡å¸‚"
    ]
}

# ç¾åœ¨VERIFIEDæ¸ˆã¿ã®è‡ªæ²»ä½“ï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œçµæœã‹ã‚‰å–å¾—ï¼‰
VERIFIED_MUNICIPALITIES = [
    # æ±äº¬éƒ½
    "åƒä»£ç”°åŒº", "ä¸­å¤®åŒº", "å“å·åŒº", "æ–°å®¿åŒº", "å¤§ç”°åŒº", "æ¿æ©‹åŒº", "æ±Ÿæˆ¸å·åŒº", "æ±Ÿæ±åŒº", "ç›®é»’åŒº",
    # ç¥å¥ˆå·çœŒ
    "æ¨ªæµœå¸‚", "å·å´å¸‚", "ç›¸æ¨¡åŸå¸‚", "æ¨ªé ˆè³€å¸‚", "å¹³å¡šå¸‚", "éŒå€‰å¸‚", "è—¤æ²¢å¸‚", "å°ç”°åŸå¸‚",
    "èŒ…ãƒ¶å´å¸‚", "é€—å­å¸‚", "ä¸‰æµ¦å¸‚", "ç§¦é‡å¸‚", "åšæœ¨å¸‚", "å¤§å’Œå¸‚", "ä¼Šå‹¢åŸå¸‚", "æµ·è€åå¸‚", "åº§é–“å¸‚",
    # åƒè‘‰çœŒ
    "åƒè‘‰å¸‚", "å¸‚å·å¸‚", "èˆ¹æ©‹å¸‚", "æ¾æˆ¸å¸‚", "é‡ç”°å¸‚", "ä½å€‰å¸‚", "ç¿’å¿—é‡å¸‚", "æŸå¸‚",
    "å¸‚åŸå¸‚", "æµå±±å¸‚", "å…«åƒä»£å¸‚",
    # åŸ¼ç‰çœŒ
    "ã•ã„ãŸã¾å¸‚", "å·è¶Šå¸‚", "ç†Šè°·å¸‚", "å·å£å¸‚", "æ‰€æ²¢å¸‚", "æ˜¥æ—¥éƒ¨å¸‚", "ä¸Šå°¾å¸‚", "è‰åŠ å¸‚",
    "è¶Šè°·å¸‚", "è•¨å¸‚", "æˆ¸ç”°å¸‚", "æœéœå¸‚", "å’Œå…‰å¸‚", "æ–°åº§å¸‚", "ä¹…å–œå¸‚", "å…«æ½®å¸‚"
]

def analyze_missing():
    """ä¸è¶³è‡ªæ²»ä½“ã‚’éƒ½é“åºœçœŒåˆ¥ã«åˆ†æ"""
    results = {}
    total_all = 0
    total_verified = 0
    total_missing = 0
    
    for prefecture, municipalities in ALL_MUNICIPALITIES.items():
        all_count = len(municipalities)
        verified = [m for m in municipalities if m in VERIFIED_MUNICIPALITIES]
        missing = [m for m in municipalities if m not in VERIFIED_MUNICIPALITIES]
        
        results[prefecture] = {
            "all_count": all_count,
            "verified_count": len(verified),
            "missing_count": len(missing),
            "verified": verified,
            "missing": missing,
            "coverage": (len(verified) / all_count * 100) if all_count > 0 else 0
        }
        
        total_all += all_count
        total_verified += len(verified)
        total_missing += len(missing)
    
    # ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
    print("=" * 80)
    print("1éƒ½3çœŒ è‡ªæ²»ä½“ãƒ‡ãƒ¼ã‚¿ã‚«ãƒãƒ¬ãƒƒã‚¸åˆ†æãƒ¬ãƒãƒ¼ãƒˆ")
    print("=" * 80)
    print()
    
    for prefecture, data in results.items():
        print(f"ã€{prefecture}ã€‘")
        print(f"  å…¨è‡ªæ²»ä½“æ•°: {data['all_count']}")
        print(f"  VERIFIED: {data['verified_count']} ({data['coverage']:.1f}%)")
        print(f"  æœªçµ±åˆ: {data['missing_count']}")
        if data['missing']:
            print(f"  æœªçµ±åˆè‡ªæ²»ä½“: {', '.join(data['missing'][:10])}")
            if len(data['missing']) > 10:
                print(f"               ...ä»–{len(data['missing'])-10}è‡ªæ²»ä½“")
        print()
    
    print("=" * 80)
    print(f"ã€åˆè¨ˆã€‘")
    print(f"  å…¨è‡ªæ²»ä½“æ•°: {total_all}")
    print(f"  VERIFIED: {total_verified} ({total_verified/total_all*100:.1f}%)")
    print(f"  æœªçµ±åˆ: {total_missing}")
    print("=" * 80)
    print()
    
    # æœªçµ±åˆè‡ªæ²»ä½“ãƒªã‚¹ãƒˆã‚’CSVå‡ºåŠ›
    with open('missing_municipalities_full.csv', 'w', encoding='utf-8') as f:
        f.write("prefecture,municipality,status,priority\n")
        for prefecture, data in results.items():
            for city in data['missing']:
                # å„ªå…ˆåº¦åˆ¤å®šï¼ˆäººå£è¦æ¨¡ã‚„é‡è¦åº¦ã«åŸºã¥ãï¼‰
                priority = "A"  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å…¨ã¦Aï¼ˆé‡è¦ï¼‰
                f.write(f'{prefecture},{city},TO_COLLECT,{priority}\n')
    
    print("âœ… æœªçµ±åˆè‡ªæ²»ä½“ãƒªã‚¹ãƒˆã‚’ 'missing_municipalities_full.csv' ã«å‡ºåŠ›ã—ã¾ã—ãŸ")
    print()
    
    return results, total_missing

if __name__ == "__main__":
    results, total_missing = analyze_missing()
    
    print(f"ğŸ“Š æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: {total_missing}è‡ªæ²»ä½“ã®ãƒ‡ãƒ¼ã‚¿åé›†ã‚’å®Ÿè¡Œ")
    print("   å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰: python3 scripts/batch_collect_municipalities.py")
