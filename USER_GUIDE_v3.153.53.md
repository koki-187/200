# 🔧 トラブルシューティングガイド v3.153.53

**Production URL**: https://94d0d9af.real-estate-200units-v2.pages.dev  
**ログイン**: navigator-187@docomo.ne.jp / kouki187  

---

## 🚨 報告された問題と解決策

### **問題1: 「ストレージ情報取得中...」が表示され続ける**

**原因**:
- 認証トークンの有効期限切れ
- ログインが正しく完了していない

**解決策**:
1. **ブラウザのキャッシュをクリア** (Ctrl+Shift+R または Cmd+Shift+R)
2. **再度ログイン**:
   - https://94d0d9af.real-estate-200units-v2.pages.dev にアクセス
   - メールアドレス: navigator-187@docomo.ne.jp
   - パスワード: kouki187
3. ログイン後、ストレージ情報が表示されるか確認

**v3.153.53での改善**:
- 認証エラー時に「認証エラー（再ログインが必要です）」と表示
- 3秒後に自動的にログインページへリダイレクト
- トースト通知で明確なフィードバック

---

### **問題2: ファイル管理で「総ファイル数: 0」と表示される**

**原因**:
- 実際にファイルがアップロードされていない
- データベースにファイルレコードが存在しない

**解決策**:
1. **案件作成ページからファイルをアップロード**:
   - ログイン後、「新規案件」または「案件を作成」ボタンをクリック
   - ファイルアップロードエリアにPDFまたは画像をドロップ
   - OCR処理が完了するまで待つ
   - 案件情報を入力して「案件を作成」をクリック

2. **ファイル管理ページを再確認**:
   - 「ファイル管理」メニューをクリック
   - アップロードしたファイルが一覧に表示されることを確認

**v3.153.53での改善**:
- ファイルが0件の場合、明確なメッセージを表示:
  ```
  アップロードされたファイルがありません
  案件作成ページからファイルをアップロードしてください。
  ```
- 「案件を作成する」ボタンで直接案件作成ページへ移動可能

---

### **問題3: OCR機能が使えない**

**根本原因**:
- ストレージAPIエラーが原因でOCR処理が開始できない
- 認証トークンの有効期限切れ

**解決策**:
1. **問題1を解決** (再ログイン)
2. **OCR処理の手順**:
   - 案件作成ページ (`/deals/create`) を開く
   - ファイルアップロードエリアに**PDFファイル**をドロップ
   - 自動的にOCR処理が開始される
   - 「OCR処理中...」の表示を確認
   - 処理完了後、フォームフィールドに自動入力される

**サポートされているファイル形式**:
- PDF
- PNG
- JPG/JPEG
- WEBP

**最大ファイル数**: 10ファイル（一度に複数アップロード可能）

---

## ✅ 正常な動作フロー

### **1. ログイン**
```
1. https://94d0d9af.real-estate-200units-v2.pages.dev にアクセス
2. メールアドレス: navigator-187@docomo.ne.jp
3. パスワード: kouki187
4. ログインボタンをクリック
5. ダッシュボードにリダイレクトされる
```

### **2. ファイルアップロードとOCR処理**
```
1. 「新規案件」ボタンをクリック（緑色）
2. ファイルアップロードエリアにPDFをドロップ
3. 「ストレージ情報: XX MB / 100 MB」が表示されることを確認
4. OCR処理が自動的に開始される
5. 処理完了後、以下のフィールドが自動入力される:
   - 物件名
   - 所在地
   - 土地面積
   - 用途地域
   - 建蔽率
   - 容積率
   - 高度地区
   - 防火地域
   - 接道情報
   - 間口
```

### **3. リスクチェック実行**
```
1. 所在地が入力されていることを確認
2. 「総合リスクチェック実施」ボタンをクリック
3. アラートで以下の情報が表示される:
   - 住所
   - 都道府県
   - 市区町村
   - 【総合判定】
     ✅ 融資可能（問題なし）
     ❌ 融資不可（要注意）
     ⚠️ 手動確認が必要
   - 処理時間
```

### **4. 案件作成**
```
1. 必須フィールドを確認:
   - 物件名
   - 所在地
   - 土地面積
2. 売主が自動選択されていることを確認
3. 「案件を作成」ボタンをクリック
4. 成功メッセージ「案件を作成しました」が表示される
5. 案件詳細ページにリダイレクトされる
```

### **5. ファイル管理の確認**
```
1. 「ファイル管理」メニューをクリック
2. 統計情報を確認:
   - 総ファイル数: （アップロードしたファイル数）
   - 総ストレージ使用量: XX MB
   - 登録ユーザー数: 1
3. ファイル一覧でアップロードしたファイルを確認
4. ダウンロードまたは削除が可能
```

---

## 🔍 エラー発生時のチェックリスト

### **認証関連エラー**
- [ ] ブラウザのキャッシュをクリアした (Ctrl+Shift+R)
- [ ] 正しいメールアドレスとパスワードを使用している
- [ ] ログイン後、ダッシュボードにリダイレクトされた
- [ ] ブラウザのコンソール (F12 → Console) でエラーがないか確認

### **ストレージ関連エラー**
- [ ] ログイン後、「ストレージ情報: XX MB / 100 MB」が表示される
- [ ] 「ストレージ情報取得中...」が3秒以上続く場合は再ログイン
- [ ] コンソールで `[Storage Quota] Successfully loaded` が表示される

### **OCR関連エラー**
- [ ] アップロードするファイルがPDF形式である
- [ ] ファイルサイズが10MB以下である
- [ ] 案件作成ページ (`/deals/create`) を開いている
- [ ] コンソールで `[OCR Init] v3.153.50 loaded` が表示される

### **ファイル管理関連エラー**
- [ ] 管理者アカウントでログインしている
- [ ] 案件を作成してファイルをアップロードした
- [ ] コンソールで `[File Management]` 関連のエラーがないか確認

---

## 📞 サポート情報

### **バージョン情報**
- **現在のバージョン**: v3.153.53
- **デプロイ日時**: 2025-12-11 08:40 JST
- **Git Commit**: 6d569d5

### **デバッグ方法**
1. **ブラウザコンソールを開く** (F12 → Console)
2. **エラーメッセージを確認**:
   - `[Storage Quota]` で始まるメッセージ: ストレージAPI関連
   - `[OCR Init]` で始まるメッセージ: OCR初期化関連
   - `[File Management]` で始まるメッセージ: ファイル管理関連
3. **スクリーンショットを撮影**:
   - エラーメッセージ
   - コンソールログ
   - 問題が発生している画面

---

## 🎯 重要な注意事項

### **ファイルが表示されない場合**
✅ **これは正常です**。まだファイルをアップロードしていない場合:
- 「アップロードされたファイルがありません」と表示されます
- 「案件を作成する」ボタンから新規案件を作成してください

### **認証エラーが発生する場合**
✅ **v3.153.53で改善済み**:
- 明確なエラーメッセージ: 「認証エラー（再ログインが必要です）」
- 3秒後に自動的にログインページへリダイレクト
- トースト通知で視覚的フィードバック

### **ストレージ情報が「取得中...」のまま**
✅ **v3.153.53で改善済み**:
- 認証エラー時に自動的に「認証エラー」と表示
- ネットワークエラー時に「ネットワークエラー」と表示
- 詳細なエラー情報をコンソールに出力

---

## 🚀 次のステップ

1. **ログインして動作確認**
   - https://94d0d9af.real-estate-200units-v2.pages.dev
   - navigator-187@docomo.ne.jp / kouki187

2. **テスト案件を作成**
   - PDFファイルをアップロード
   - OCR処理を確認
   - リスクチェックを実行
   - 案件を作成

3. **ファイル管理を確認**
   - 統計情報が更新されているか確認
   - ファイル一覧にアップロードしたファイルが表示されるか確認

4. **問題が解決しない場合**
   - ブラウザのコンソールログをスクリーンショット
   - 問題が発生している画面をスクリーンショット
   - 次のチャットで詳細を報告

---

すべての機能が正常に動作することを確認してください。
