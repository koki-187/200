# Changelog

## [v3.9.0] - 2025-11-19

### 🎯 主要変更：OCR完全非同期化実装

#### 追加機能
- ✨ **OCR非同期処理API**（`/api/ocr-jobs`）
  - `POST /api/ocr-jobs`: 新しいOCRジョブを作成（即座にジョブIDを返却）
  - `GET /api/ocr-jobs/:jobId`: ジョブの進捗とステータスを取得
  - `GET /api/ocr-jobs`: ユーザーの全OCRジョブ一覧を取得
  - `DELETE /api/ocr-jobs/:jobId`: ジョブを削除

- ✨ **ポーリングベースの進捗監視**
  - フロントエンドが1秒ごとにジョブステータスをポーリング
  - リアルタイムで処理中のファイル数、進捗パーセンテージを更新
  - 推定残り時間（ETA）を表示

- ✨ **リトライ機能の完成**
  - `lastUploadedFiles`変数にアップロードされたファイルを自動保存
  - エラー時に「再試行」ボタンで同じファイルを即座に再送信可能

#### 改善
- 🚀 **タイムアウト問題を根本的に解決**
  - Cloudflare Workersの10ms CPU制限を回避
  - バックグラウンドで`c.executionCtx.waitUntil()`を使用
  - 最大2分間のポーリング（120秒）
  - 複数ファイル処理時のタイムアウトエラーを解消

- 💡 **進捗表示の正確性向上**
  - 実際の処理状況に基づく進捗バー更新（以前はシミュレーション）
  - ファイル毎のステータス表示（待機中 → 処理中 → 完了）

#### 技術詳細
- 新規ファイル: `src/routes/ocr-jobs.ts`
- 更新ファイル: `src/index.tsx`（processMultipleOCR関数を完全書き換え）
- データベース: `ocr_jobs`テーブル活用（既存）

#### 既知の問題
- なし（テスト待ち）

#### 次回実装予定
- WebSocket対応（Cloudflare Durable Objects使用）
- バッチ処理最適化（並列処理）
- 進捗状況の永続化（ブラウザリロード後も継続）
- ジョブキャンセル機能
- ジョブ履歴管理UI

---

## [v3.8.0] - 2025-11-18

### 🎯 主要変更：OCR精度向上と履歴管理

#### 追加機能
- ✨ **フィールド毎の信頼度スコア**
  - 各抽出フィールドに0.0〜1.0の信頼度を表示
  - overall_confidence（全体平均信頼度）
  - UIで信頼度に応じた色分け（高：緑、中：黄、低：赤）

- ✨ **OCR履歴管理機能**
  - 検索・フィルター機能（物件名・所在地・信頼度範囲）
  - 履歴一覧表示（最大50件）
  - 履歴からの再利用機能
  - APIエンドポイント: `/api/ocr-history`

- ✨ **物件テンプレート管理**
  - テンプレート保存・読込
  - APIエンドポイント: `/api/property-templates`

- ✨ **OCR設定管理**
  - 設定のカスタマイズ
  - APIエンドポイント: `/api/ocr-settings`

#### 改善
- 🐛 **wranglerマイグレーションのバグ回避**
  - CREATE INDEX文のエラーを手動SQL実行で回避
  - `ocr_jobs`テーブル作成完了

#### 技術詳細
- 新規ファイル: `src/routes/ocr-history.ts`, `src/routes/property-templates.ts`, `src/routes/ocr-settings.ts`
- マイグレーション: `migrations/0012_add_ocr_jobs_and_field_confidence.sql`

---

## [v3.7.0] - 2025-11-17

### 🎯 主要変更：テンプレート管理UI・OCR設定UI実装

#### 追加機能
- ✨ **テンプレート管理UI**
- ✨ **OCR設定UI**

#### 改善
- 🚀 本番環境デプロイ完了

---

## [v3.6.0] - 2025-11-16

### 🎯 主要変更：買取条件チェック機能実装

#### 追加機能
- ✨ **買取条件自動チェック機能**
  - 対象エリア判定
  - 買取条件判定
  - 検討外エリア判定

---

## [v3.5.0] - 2025-11-15

### 🎯 主要変更：OCR UI強化

#### 追加機能
- ✨ **OCR UI強化版デプロイ**

---

## [v3.4.0] - 2025-11-14

### 🎯 主要変更：PDF/画像混在OCR完全修復

#### 追加機能
- ✨ **PDF/画像混在OCR**
  - 最大10ファイル一括処理
  - 強化されたUIデザイン

---

## [v3.3.0] - 2025-11-13

### 🎯 主要変更：ジオコーディングAPI実装

#### 追加機能
- ✨ **ジオコーディングAPI**
  - Google Maps API統合

---

## [v3.2.0] - 2025-11-12

### 🎯 主要変更：買取条件API実装

#### 追加機能
- ✨ **買取条件API**
  - `/api/purchase-criteria`

---

## [v3.1.0] - 2025-11-11

### 🎯 主要変更：買取条件自動チェック

#### 追加機能
- ✨ **買取条件自動チェック**

---

## [v3.0.0] - 2025-11-10

### 🎯 主要変更：物件情報OCR実装

#### 追加機能
- ✨ **物件情報OCR（複数ファイル一括処理）**

---

## [v2.7.0] - 2025-11-09

### 🎯 主要変更：名刺OCR機能

#### 追加機能
- ✨ **名刺OCR機能（縦型・横型・英語対応）**

---

## [v2.5.0] - 2025-11-08

### 🎯 主要変更：メール通知とAI投資分析

#### 追加機能
- ✨ **メール自動通知（Resend API）**
- ✨ **AI投資分析・提案生成（GPT-4o）**
- ✨ **Remember Me機能**

---

## [v2.0.0] - 2025-11-07

### 🎯 主要変更：プッシュ通知実装

#### 追加機能
- ✨ **ブラウザプッシュ通知**

---

## [v1.0.0] - 2025-11-06

### 🎯 初回リリース

#### 基本機能
- ✅ 認証・セキュリティ
- ✅ ユーザー管理
- ✅ 案件管理
- ✅ コミュニケーション
- ✅ ファイル管理
