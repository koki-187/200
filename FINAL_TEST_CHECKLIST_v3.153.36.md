# 最終テストチェックリスト v3.153.36

**作成日時**: 2025-12-10  
**バージョン**: v3.153.36  
**本番URL**: https://9cc9794e.real-estate-200units-v2.pages.dev  
**ログイン**: navigator-187@docomo.ne.jp / kouki187 (管理者アカウント)  
**テストファイル**: 物件概要書_品川区西中延2-15-12.pdf

---

## 🎯 最終リリース前の必須テスト項目

このチェックリストは、**ユーザー自身が本番環境で実施する必要がある**最終確認項目です。

### ⚠️ 重要な注意事項

1. **エラーが発生した場合は必ず3回テストしてください**
2. **ブラウザのコンソールログ (F12 → Console) を常に開いておいてください**
3. **ネットワークタブ (F12 → Network) でAPIリクエストを監視してください**
4. **エラーメッセージをスクリーンショットで保存してください**
5. **各テスト後、必ず結果を記録してください**

---

## 📋 テスト項目一覧

### 🔴 優先度: 最高 (必須テスト)

#### 1. OCR機能の完全テスト ✅ (初期ロードは確認済み)

**テスト手順**:

1. **準備**:
   - ブラウザで https://9cc9794e.real-estate-200units-v2.pages.dev にアクセス
   - `navigator-187@docomo.ne.jp` / `kouki187` でログイン
   - ブラウザのコンソールログ (F12 → Console) を開く

2. **OCRファイルアップロード**:
   - 「案件作成」ページへ移動
   - `物件概要書_品川区西中延2-15-12.pdf` をドラッグ&ドロップまたはファイル選択
   - OCR処理の進捗バーを確認
   - 処理完了まで待機 (30秒〜1分程度)

3. **コンソールログ確認** (重要):
   ```
   [OCR] FULL extracted_data: { ... }
   [OCR] Set location: 東京都品川区西中延2-15-12
   [OCR] Set height_district: 第二種高度地区
   [OCR] Set fire_zone: 準防火地域
   [OCR] Set frontage: 4.14m
   [OCR] Set desired_price: 14500
   ```

4. **フォーム入力確認** (画面上で目視確認):
   - [ ] **所在地**: `東京都品川区西中延2-15-12` が入力されているか
   - [ ] **高度地区**: `第二種高度地区` が入力されているか ⚠️ **重要**
   - [ ] **防火地域**: `準防火地域` が入力されているか ⚠️ **重要**
   - [ ] **間口**: `4.14m` のみが入力されているか (「東側 幅員4.14m」ではない) ⚠️ **重要**
   - [ ] **道路情報**: `北側私道 幅員2.0m 接道2.0m` などが入力されているか
   - [ ] **用途地域**: `第一種住居地域` などが入力されているか
   - [ ] **建ぺい率**: `60%` が入力されているか
   - [ ] **容積率**: `200%` が入力されているか
   - [ ] **希望価格**: `14500` (万円) が入力されているか

5. **結果記録**:
   - ✅ 成功: 全てのフィールドが正しく入力されている
   - ❌ 失敗: どのフィールドが空白または誤っているか記録
   - ⚠️ 部分成功: 一部のフィールドのみ入力されている場合、どれが成功/失敗か記録

**期待される結果**:
- OCR処理が成功
- **高度地区**: `第二種高度地区`
- **防火地域**: `準防火地域`
- **間口**: `4.14m` (数値と単位のみ)

**エラー時の対処 (3回テスト)**:

**第1回テスト失敗時**:
1. ブラウザのキャッシュをクリア (Shift + F5)
2. 再度ログイン
3. 同じ手順で再テスト

**第2回テスト失敗時**:
1. 別のブラウザで試す (Chrome → Safari または Edge)
2. コンソールログのエラーメッセージを全てコピー
3. 再テスト

**第3回テスト失敗時**:
1. ネットワークタブで `POST /api/property-ocr/extract-multiple` のレスポンスを確認
2. レスポンスボディをコピー
3. 次のチャットでエラーの詳細を報告

---

#### 2. 高度地区・防火地域・間口のOCR抽出結果の検証

**上記「1. OCR機能の完全テスト」で確認済み**

**結果記録**:
- [ ] **高度地区**: `第二種高度地区` が正しく抽出されたか
- [ ] **防火地域**: `準防火地域` が正しく抽出されたか
- [ ] **間口**: `4.14m` (数値と単位のみ) が正しく抽出されたか

---

#### 3. 案件作成ボタン (HTTP 500エラー) の根本原因調査とエラーテスト

**テスト手順**:

1. **準備**:
   - 上記「1. OCR機能」でフォームに情報を入力
   - または手動で全ての必須フィールドを入力:
     - 案件タイトル: `品川区西中延2丁目` (例)
     - 所在地: `東京都品川区西中延2-15-12`
     - 最寄駅: `矢向`
     - 土地面積: `218.14`
     - 用途地域: `第一種住居地域`
     - 希望価格: `14500`
   - **売主を選択** (ドロップダウンから選択) ⚠️ **重要**

2. **案件作成実行**:
   - 「保存して案件作成」ボタンをクリック
   - 処理中のメッセージを確認
   - 結果を待機 (5秒程度)

3. **成功時の確認**:
   - [ ] 「案件が正常に作成されました」のメッセージが表示される
   - [ ] トップページにリダイレクトされる
   - [ ] 作成した案件がトップページの一覧に表示される

4. **失敗時の確認** (HTTP 500エラー):
   - ネットワークタブで `POST /api/deals` を探す
   - ステータスコード: `500 Internal Server Error`
   - レスポンスタブで以下を確認:
     ```json
     {
       "error": "Internal server error",
       "message": "...",
       "type": "..."
     }
     ```
   - コンソールログで以下を探す:
     ```
     [CREATE DEAL] Starting deal creation
     [CREATE DEAL] User ID: admin-001
     ❌ [CREATE DEAL ERROR] Critical error occurred: ...
     [CREATE DEAL ERROR] Error message: ...
     ```

5. **結果記録**:
   - ✅ 成功: 案件が正常に作成された
   - ❌ 失敗: HTTP 500エラーが発生
   - エラーメッセージをコピー (JSON全体)
   - コンソールログのエラーをコピー

**エラー時の対処 (3回テスト)**:

**第1回テスト失敗時**:
1. **売主が選択されているか再確認** (最も多い原因)
2. 全ての必須フィールドが入力されているか再確認
3. ブラウザのキャッシュをクリア (Shift + F5)
4. 再度ログイン
5. 再テスト

**第2回テスト失敗時**:
1. 別のブラウザで試す
2. 全てのフィールドを**手動で入力** (OCRを使わない)
3. 売主を確実に選択
4. 再テスト

**第3回テスト失敗時**:
1. ネットワークタブとコンソールログの全てのエラーをコピー
2. リクエストボディ (送信したデータ) もコピー
3. 次のチャットで詳細を報告:
   - レスポンスボディ (JSON)
   - コンソールログのエラー
   - リクエストボディ
   - スクリーンショット

---

#### 4. リスクチェック機能の動作確認

**テスト手順**:

1. **準備**:
   - 案件作成ページで「所在地」フィールドに `東京都品川区西中延2-15-12` を入力

2. **リスクチェック実行**:
   - 「総合リスクチェック実施」ボタンをクリック
   - 処理中のメッセージを確認
   - 結果を待機 (10〜20秒)

3. **成功時の確認**:
   - [ ] モーダルウィンドウが表示される
   - [ ] 「ハザードマップ情報」が表示される
   - [ ] 「建築基準法情報」が表示される
   - [ ] 用途地域、建ぺい率、容積率、高度地区、防火地域が含まれているか

4. **失敗時の確認**:
   - エラーメッセージが表示される
   - コンソールログでエラーを確認

5. **結果記録**:
   - ✅ 成功: リスクチェック結果が表示された
   - ❌ 失敗: エラーが発生した
   - エラーメッセージをコピー

**エラー時の対処 (3回テスト)**:

**第1回テスト失敗時**:
1. 住所が正確か再確認 (都道府県から番地まで)
2. ブラウザのキャッシュをクリア
3. 再テスト

**第2回テスト失敗時**:
1. 別の住所で試す (例: `東京都渋谷区渋谷1-1-1`)
2. 数分待ってから再テスト (APIレート制限の可能性)

**第3回テスト失敗時**:
1. コンソールログとネットワークタブのエラーをコピー
2. 次のチャットで報告

---

#### 5. 物件情報自動補完機能の検証

**テスト手順**:

1. **準備**:
   - 案件作成ページで「所在地」フィールドに `東京都品川区西中延2-15-12` を入力

2. **自動補完実行**:
   - 「物件情報自動補完」ボタンをクリック
   - 処理中のメッセージを確認
   - 結果を待機 (5〜10秒)

3. **成功時の確認**:
   - [ ] 土地面積が自動入力される
   - [ ] 建物面積が自動入力される
   - [ ] 用途地域が自動入力される
   - [ ] 建ぺい率が自動入力される
   - [ ] 容積率が自動入力される
   - [ ] 最寄駅が自動入力される
   - [ ] 徒歩分数が自動入力される

4. **失敗時の確認**:
   - エラーメッセージが表示される
   - コンソールログでエラーを確認

5. **結果記録**:
   - ✅ 成功: 物件情報が自動入力された
   - ⚠️ 部分成功: 一部のフィールドのみ入力された
   - ❌ 失敗: エラーが発生した
   - エラーメッセージをコピー

**エラー時の対処 (3回テスト)**:

**第1回テスト失敗時**:
1. 住所が正確か再確認
2. 別の住所で試す
3. 再テスト

**第2回〜第3回テスト**:
- 「4. リスクチェック機能」と同じ手順

---

### 🟡 優先度: 中 (推奨テスト)

#### 6. トップページのステータス反映確認

**テスト手順**:

1. トップページにアクセス
2. 上記で作成した案件が一覧に表示されているか確認
3. ステータスが「NEW」(新規案件) になっているか確認
4. 案件詳細ページを開く
5. ステータスを「ANSWERED」(回答済み) に変更
6. トップページに戻る
7. ステータスが「ANSWERED」に変更されているか確認

**結果記録**:
- [ ] 案件がトップページに表示される
- [ ] ステータス変更が反映される
- [ ] ステータスサマリーの数値が更新される

---

#### 7. ファイル管理・書類保存の動作確認

**テスト手順**:

1. 案件詳細ページを開く
2. 「ファイル管理」タブをクリック
3. 「ファイルをアップロード」ボタンをクリック
4. `物件概要書_品川区西中延2-15-12.pdf` を選択
5. アップロード完了を確認
6. ファイル一覧に表示されるか確認
7. ダウンロードボタンをクリックして正常にダウンロードできるか確認

**結果記録**:
- [ ] ファイルアップロードが成功
- [ ] ファイル一覧に表示される
- [ ] ダウンロードが正常に動作する

---

#### 8. 建築基準情報の正確な表示確認

**テスト手順**:

1. 「4. リスクチェック機能」を実行
2. リスクチェック結果のモーダルで「建築基準法情報」タブをクリック
3. 以下の情報が表示されているか確認:
   - [ ] 用途地域
   - [ ] 建ぺい率
   - [ ] 容積率
   - [ ] 高度地区
   - [ ] 防火地域
   - [ ] 道路幅員

**結果記録**:
- [ ] 全ての情報が表示される
- [ ] 表示内容が正確である (OCRの結果と一致)

---

#### 9. 管理者ログイン履歴の動作確認

**テスト手順**:

1. 管理者アカウント (`navigator-187@docomo.ne.jp`) でログイン
2. 左上のメニューから「ログイン履歴」をクリック
3. ログイン履歴一覧が表示されるか確認
4. 自分のログイン記録が含まれているか確認
5. 一般ユーザーでログインして「ログイン履歴」が表示されないか確認 (将来のテスト)

**結果記録**:
- [ ] ログイン履歴が表示される
- [ ] 自分のログイン記録が含まれている
- [ ] 管理者以外はアクセスできない (将来確認)

---

### 🟢 優先度: 低 (オプション)

#### 10. デモ/サンプルデータ混在の完全除去確認

**テスト手順**:

1. トップページの案件一覧を確認
2. 明らかにテスト用/サンプル用の案件がないか確認
3. データベースに不要なデータが残っていないか確認

**結果記録**:
- [ ] サンプルデータが含まれていない
- [ ] 全ての案件が実際の物件情報である

---

## 📊 テスト結果サマリー

**テスト実施日**: _______________  
**テスト実施者**: _______________

| ID | テスト項目 | 第1回 | 第2回 | 第3回 | 最終結果 | 備考 |
|----|-----------|-------|-------|-------|---------|------|
| 1 | OCR機能 | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ |  |
| 2 | 高度地区・防火地域・間口 | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ |  |
| 3 | 案件作成ボタン | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ |  |
| 4 | リスクチェック | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ |  |
| 5 | 物件情報自動補完 | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ | ⬜ ✅ / ❌ |  |
| 6 | トップページ反映 | ⬜ ✅ / ❌ | - | - | ⬜ ✅ / ❌ |  |
| 7 | ファイル管理 | ⬜ ✅ / ❌ | - | - | ⬜ ✅ / ❌ |  |
| 8 | 建築基準情報 | ⬜ ✅ / ❌ | - | - | ⬜ ✅ / ❌ |  |
| 9 | ログイン履歴 | ⬜ ✅ / ❌ | - | - | ⬜ ✅ / ❌ |  |
| 10 | サンプルデータ除去 | ⬜ ✅ / ❌ | - | - | ⬜ ✅ / ❌ |  |

---

## 🚨 重要な注意事項

### エラーが発生した場合の報告内容

次のチャットでエラーを報告する際は、以下の情報を含めてください:

1. **テスト項目番号**: (例: "3. 案件作成ボタン")
2. **エラーメッセージ** (JSON全体):
   ```json
   {
     "error": "...",
     "message": "...",
     "type": "..."
   }
   ```
3. **コンソールログ** (エラー部分のみ):
   ```
   ❌ [CREATE DEAL ERROR] Critical error occurred: ...
   [CREATE DEAL ERROR] Error message: ...
   ```
4. **スクリーンショット**: エラー画面全体
5. **テスト環境**:
   - ブラウザ: (Chrome / Safari / Edge)
   - OS: (Windows / Mac / iOS / Android)
   - テスト日時: (例: 2025-12-10 15:30)

---

## ✅ リリース判定基準

### 必須テスト (ID 1-5) がすべて成功した場合

**リリース可能** 🎉

- システムは本番環境で正常に動作しています
- ユーザーガイド (`USER_GUIDE_v3.153.36.md`) を参照して運用を開始できます

### 必須テスト (ID 1-5) のいずれかが失敗した場合

**リリース不可** ❌

- 次のチャットでエラーの詳細を報告してください
- エラーの根本原因を特定し、修正を実施します
- 修正後、再度テストを実施します

---

**このチェックリストは v3.153.36 時点の情報です。**
