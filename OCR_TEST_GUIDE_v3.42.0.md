# OCR機能テストガイド - v3.42.0

## 📅 テスト情報
- **バージョン**: v3.42.0
- **本番URL**: https://79a2845f.real-estate-200units-v2.pages.dev
- **テスト日**: 2025-11-25
- **対象機能**: OCR自動入力機能

---

## 🔐 ログイン情報

### 管理者アカウント
- **URL**: https://79a2845f.real-estate-200units-v2.pages.dev/
- **メールアドレス**: navigator-187@docomo.ne.jp
- **パスワード**: kouki187

---

## 📋 OCR機能テスト手順

### **ステップ1: ログイン**
1. 上記の本番URLにアクセス
2. 管理者アカウントでログイン
3. ダッシュボードが表示されることを確認

### **ステップ2: 案件作成ページへ移動**
1. 画面上部のナビゲーションメニューから「案件作成」をクリック
2. URL: https://79a2845f.real-estate-200units-v2.pages.dev/deals/new
3. 「OCR自動入力」セクションが表示されることを確認

### **ステップ3: ファイルをアップロード**

#### 方法A: ドラッグ&ドロップ
1. 登記簿謄本や図面のPDF/画像ファイルを準備
2. ファイルを「ドラッグ＆ドロップでファイルをアップロード」エリアにドラッグ
3. ファイルがドロップされると、ファイルプレビューが表示される

#### 方法B: ファイル選択ボタン
1. 「ファイルを選択」ボタンをクリック
2. ファイル選択ダイアログが表示される
3. 登記簿謄本や図面のPDF/画像ファイルを選択
4. ファイルプレビューが表示される

**対応ファイル形式**:
- PDF（`.pdf`）
- 画像（`.png`, `.jpg`, `.jpeg`, `.webp`）
- 最大10ファイルまで同時処理可能

### **ステップ4: OCR処理の開始**
1. ファイルプレビューが表示されたら、「OCR処理を開始」ボタンが表示される
2. ボタンをクリックするとOCR処理が開始
3. **進捗表示**が表示される:
   - 進捗バー（0% → 100%）
   - 推定残り時間
   - 各ファイルの処理状況

### **ステップ5: OCR結果の確認**
OCR処理が完了すると、以下の情報が表示されます:

#### 抽出されるフィールド
- 📍 **所在地**: 物件の住所
- 📏 **土地面積**: 平方メートル単位
- 🏘️ **用途地域**: 第一種住居地域など
- 🏠 **建蔽率**: パーセンテージ
- 🏢 **容積率**: パーセンテージ
- 📐 **高度地区**: 第1種高度地区など
- 🔥 **防火地域**: 準防火地域など
- 🛣️ **道路情報**: 接道状況
- 💰 **希望価格**: 金額
- 📄 **現況**: 更地、古家付きなど

#### 信頼度スコア
各フィールドには信頼度スコアが表示されます:
- 🟢 **緑色（90%以上）**: 高信頼度
- 🟡 **黄色（70-90%）**: 中信頼度
- 🔴 **赤色（70%未満）**: 低信頼度（要確認）

### **ステップ6: OCR結果の適用**
1. 抽出結果を確認
2. 低信頼度のフィールドは手動で修正可能
3. 「フォームに適用」ボタンをクリック
4. 案件作成フォームに自動入力される

---

## 🐛 よくあるエラーと対処法

### ❌ エラー1: 「ファイルを選択してください」
**原因**: ファイルが正しく選択されていない  
**対処法**:
- ファイル形式を確認（PDF、PNG、JPG、WEBP のみ対応）
- ファイルサイズを確認（1ファイル10MB以下）
- ブラウザをリロードして再試行

### ❌ エラー2: 「OpenAI APIエラー」
**原因**: OpenAI APIの呼び出しに失敗  
**対処法**:
- インターネット接続を確認
- しばらく待ってから再試行（APIレート制限の可能性）
- 「リトライ」ボタンをクリック

### ❌ エラー3: 「処理がタイムアウトしました」
**原因**: OCR処理に時間がかかりすぎている  
**対処法**:
- ファイル数を減らす（一度に5ファイル以下を推奨）
- ファイルサイズを小さくする
- 「リトライ」ボタンをクリック

### ❌ エラー4: 「ファイルプレビューが表示されない」
**原因**: JavaScriptエラーまたはイベントリスナーの問題  
**対処法**:
1. ブラウザのデベロッパーツールを開く（F12キー）
2. コンソールタブを確認
3. エラーメッセージをスクリーンショットで保存
4. ページをリロード（Ctrl+F5）して再試行

### ❌ エラー5: 「OCR処理を開始」ボタンが表示されない
**原因**: `processMultipleOCR` 関数が読み込まれていない  
**対処法**:
1. ブラウザのキャッシュをクリア
2. ページをリロード（Ctrl+Shift+R）
3. ブラウザのコンソールで以下を確認:
   ```javascript
   typeof processMultipleOCR
   ```
   - `"function"` と表示されれば正常
   - `"undefined"` と表示される場合はバグ報告

---

## 🔍 デバッグ情報の収集方法

OCR機能が動作しない場合、以下の情報を収集してください:

### 1. ブラウザコンソールログ
1. F12キーを押してデベロッパーツールを開く
2. 「Console」タブを選択
3. ファイルをアップロードして操作を実行
4. すべてのログメッセージをコピー

### 2. ネットワークログ
1. デベロッパーツールの「Network」タブを選択
2. ファイルをアップロードして操作を実行
3. 失敗したリクエスト（赤色）を確認
4. リクエスト/レスポンスの詳細をコピー

### 3. エラーメッセージのスクリーンショット
- 画面に表示されるエラーメッセージをすべてスクリーンショット

---

## ✅ 期待される動作

### 正常な動作フロー
1. ✅ ファイル選択 → ファイルプレビュー表示
2. ✅ 「OCR処理を開始」ボタンクリック → 進捗バー表示
3. ✅ 進捗バーが100%に達する → OCR結果表示
4. ✅ 「フォームに適用」ボタンクリック → 自動入力完了

### コンソールログの例（正常時）
```
[Event Delegation] window.load - Starting initialization
[Event Delegation] Initializing event delegation
[Event Delegation] Event delegation setup complete
[Event Delegation] Drop zone initialized
[Event Delegation] File input changed
[Event Delegation] Files selected: 1
[OCR] Processing 1 files...
[OCR] Job created: ocr-job-xxxxx
[OCR] Polling job status...
[OCR] Job completed successfully
[OCR] Results applied to form
```

---

## 🚀 新機能（v3.42.0）

### 1. 不動産情報ライブラリAPI統合準備
- **APIキー**: 設定済み（`cc077c568d8e4b0e917cb0660298821e`）
- **環境変数**: `MLIT_API_KEY`
- **ステータス**: 本番環境に設定完了

### 2. OpenAI APIキー確認
- **ステータス**: 設定済み、正常動作確認済み
- **モデル**: GPT-4o（最新バージョン）

---

## 📞 サポート

OCR機能に問題がある場合は、以下の情報を添えてご連絡ください:

1. 発生した操作手順
2. エラーメッセージのスクリーンショット
3. ブラウザのコンソールログ
4. 使用したファイルの種類とサイズ
5. 使用しているブラウザ（Chrome、Firefox、Safari、Edge）

---

**テスト日時**: 2025-11-25  
**バージョン**: v3.42.0  
**本番URL**: https://79a2845f.real-estate-200units-v2.pages.dev
