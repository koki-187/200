# 🧪 ユーザーテストガイド - v3.124.0

## 📅 作成日：2025-12-04
## 🚀 テストURL：https://fc1048fb.real-estate-200units-v2.pages.dev
## 🎯 目的：「読み込み中」が終わらない問題の根本原因を特定

---

## 🚨 **現在の問題**

ユーザー様から報告された問題：
> 案件作製ページの「読み込み中」にずっとなっている状態

**v3.124.0で実施した対策**：
- 詳細なデバッグログを追加
- エラーハンドリングを強化
- ジョブデータのバリデーションを追加

---

## 📋 **テスト手順**

### ステップ1：ブラウザ開発者ツールを開く

1. **Chromeの場合**：
   - `F12`キーを押す
   - または右クリック → 「検証」

2. **「Console」タブを選択**

3. **ページをリロード**（Ctrl+R または Cmd+R）

### ステップ2：ログインと画面遷移

4. テストアカウントでログイン：
   - Email: `navigator-187@docomo.ne.jp`
   - Password: `kouki187`

5. 「案件作成」ページに移動（`/deals/new`）

### ステップ3：OCR機能テスト

6. **「物件情報を自動入力」ボタンをクリック**

7. **PDFまたは画像ファイルを選択**（物件概要書など）

8. **コンソールログを注意深く観察**

---

## 🔍 **コンソールログで確認すべき項目**

### 初期化ログ（正常）
```
[OCR] ========================================
[OCR] processMultipleOCR CALLED (complete standalone version with PDF support)
[OCR] Files count: 1
[OCR] ========================================
```

### アップロードログ（ここが重要！）
```
[OCR] ========================================
[OCR] Creating OCR job...
[OCR] Total files: 1
[OCR] ========================================
[OCR] Upload progress: 100%
[OCR] ========================================
[OCR] 📥 Response received from /api/ocr-jobs
[OCR] Response status: 201  ← これが200台ならOK！
[OCR] Response data: {...}   ← ここにjob_idがあるか確認
[OCR] ========================================
[OCR] ✅ Job created successfully: abc123...
```

**❌ もしエラーが出たら：**
```
[OCR] ❌ OCR Error: ...
[OCR] Error details: {...}
```
→ このエラーメッセージをスクリーンショットで送ってください！

### ポーリングログ（処理中）
```
[OCR] 📊 Poll #1 response:
[OCR]   Status code: 200
[OCR]   Job data: {
  "status": "processing",  ← これが"completed"になるまで待つ
  "processed_files": 0,
  "total_files": 1,
  ...
}
[OCR]   Status: processing | Progress: 0/1
[OCR] ⏱️  ETA: 10s | Elapsed: 1s
```

**正常な場合、以下のように進行します：**
```
[OCR] 📊 Poll #1 - Status: processing | Progress: 0/1
[OCR] 📊 Poll #2 - Status: processing | Progress: 0/1
[OCR] 📊 Poll #3 - Status: processing | Progress: 0/1
...
[OCR] 📊 Poll #15 - Status: completed | Progress: 1/1  ← 完了！
```

**❌ もし永遠に"processing"のまま動かなかったら：**
- どのPoll番号まで進んだか確認
- ステータスが何になっているか確認
- スクリーンショットを送ってください！

### 完了ログ（成功！）
```
[OCR] ========================================
[OCR] ✅ OCR completed successfully
[OCR] Total files processed: 1
[OCR] Time taken: 15s
[OCR] Extracted data: {...}
[OCR] ========================================

[OCR] ========================================
[OCR] Auto-filling form with extracted data...
[OCR] 🔍 DETAILED FIELD VALUES:
[OCR] property_name: {"value":"○○物件", "confidence":0.8}
[OCR] location: {"value":"東京都○○区", "confidence":0.9}
[OCR] building_coverage: {"value":"60%", "confidence":0.9}
[OCR] floor_area_ratio: {"value":"200%", "confidence":0.9}
[OCR] ========================================
```

---

## 📸 **スクリーンショットのお願い**

以下のスクリーンショットを撮って送ってください：

### 1. 初期状態
- 「物件情報を自動入力」ボタンがある画面
- コンソールタブを開いた状態

### 2. ファイル選択後
- 「読み込み中...」が表示されている画面
- コンソールログ（すべて）

### 3. 問題発生時
- 「読み込み中...」がずっと続いている画面
- コンソールログの**全体**（一番上から一番下まで）
  - 特に重要：
    - `[OCR] 📥 Response received from /api/ocr-jobs`の部分
    - `[OCR] 📊 Poll #X response`の部分
    - エラーメッセージ（もしあれば）

### 4. フォームの状態
- OCR完了後（もし完了したら）、フォームに値が入力されているか
- 特に確認：
  - 物件名
  - 所在地
  - **建蔽率**
  - **容積率**

---

## 🎯 **期待される結果**

### ✅ 正常な動作の場合：

1. **「物件情報を自動入力」ボタンをクリック**
2. **ファイル選択ダイアログが開く**
3. **ファイルを選択**
4. **「読み込み中...」が表示される**（プログレスバー付き）
5. **10～30秒後、「読み込み中...」が消える**
6. **フォームに値が自動入力される**：
   - 物件名
   - 所在地
   - 最寄り駅
   - 土地面積
   - 建物面積
   - **建蔽率**（重要！）
   - **容積率**（重要！）
   - その他の項目
7. **成功メッセージが表示される**

### ❌ 問題がある場合：

- **「読み込み中...」が1分以上続く**
- **エラーメッセージが表示される**
- **フォームに値が入力されない**

→ **コンソールログのスクリーンショットを送ってください！**

---

## 💡 **トラブルシューティング**

### 問題1：「物件情報を自動入力」ボタンが見つからない
→ 案件作成ページ（`/deals/new`）にいることを確認してください

### 問題2：ファイル選択ダイアログが開かない
→ ブラウザのポップアップブロッカーを確認してください

### 問題3：コンソールにログが表示されない
→ F12を押して開発者ツールを開き、「Console」タブを選択してください

### 問題4：エラーメッセージが英語で表示される
→ 問題ありません。スクリーンショットを送ってください

---

## 📊 **デバッグ情報の読み方**

### Response status code:
- **200-299**: 成功
- **400-499**: クライアントエラー（リクエストに問題）
- **500-599**: サーバーエラー

### Job status:
- **processing**: 処理中（正常）
- **completed**: 完了（成功！）
- **failed**: 失敗（エラー）

### Progress:
- **0/1**: まだ処理開始していない
- **1/1**: 処理完了

---

## 🔧 **想定される問題パターン**

### パターンA：アップロードが失敗している
**症状**：
- `[OCR] 📥 Response received`が出ない
- または`Response status: 400`や`500`

**原因候補**：
- ファイルサイズが大きすぎる
- ファイル形式が未対応
- サーバーエラー

### パターンB：ポーリングが失敗している
**症状**：
- `[OCR] 📊 Poll #1 response`が出ない
- または`[OCR] ❌ POLLING ERROR`が出る

**原因候補**：
- ネットワークエラー
- APIエンドポイントの問題

### パターンC：ステータスが"processing"のまま
**症状**：
- `Status: processing`が何度も表示される
- `Status: completed`にならない

**原因候補**：
- OpenAI APIの処理が遅い
- OpenAI APIがエラーを返している
- サーバー側の処理が停止している

### パターンD：完了しているが、フォームに反映されない
**症状**：
- `[OCR] ✅ OCR completed successfully`が出る
- でもフォームに値が入らない

**原因候補**：
- `extracted_data`が空
- フィールドIDが一致していない
- `getFieldValue`関数の問題

---

## 📞 **サポート情報**

- **テストURL**: https://fc1048fb.real-estate-200units-v2.pages.dev
- **案件作成URL**: https://fc1048fb.real-estate-200units-v2.pages.dev/deals/new
- **テストアカウント**: navigator-187@docomo.ne.jp / kouki187
- **バージョン**: v3.124.0
- **実装**: Enhanced OCR debugging

---

## 🚀 **次のステップ**

ユーザー様からのコンソールログのスクリーンショットを受け取り次第：

1. **ログを分析**して根本原因を特定
2. **問題パターンに応じて修正**
3. **再テスト**
4. **完全修正まで繰り返し**

**目標**：「読み込み中」問題を**完全に解決**して、次の課題に進む！

---

**🎯 よろしくお願いいたします！スクリーンショットをお待ちしております！**
